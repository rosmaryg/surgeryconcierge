<html>
	<head>
		<title>Surgery Concierge</title>
		<!-- JS and CSS -->
		<link rel="stylesheet" type="text/css" href="custom_style.css">
		<link rel='stylesheet' type='text/css' href='http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css'/>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<script>
		  function createNewTemplate() {
		  var table = document.getElementById("myTable");
		  var row = table.insertRow(-1);
		  var cell1 = row.insertCell(0);
		  var cell2 = row.insertCell(1);
		  var cell3 = row.insertCell(2);
		  var cell4 = row.insertCell(3);
		  cell1.innerHTML = "<input type='checkbox'/>";
		  cell2.innerHTML = "<input type='text'/>";
		  cell3.innerHTML = "<input type='text'/>";
		  cell4.innerHTML = "<input type='text'/>";
		  return false;
		  }

		  function onSubmitForm() {
		  var n = document.getElementById("template-name").value;
		  var o = {};
		  o["title"] = n;
		  var idx = 0;
		  var table = document.getElementById("myTable");
		  for(var i = 1; i < table.rows.length; i++) {
		  if (table.rows[i].cells[0].firstChild.checked) {
	          var toAdd = [{"cond": table.rows[i].cells[1].firstChild.value},
                               {"insn": table.rows[i].cells[2].firstChild.value},
                               {"time": table.rows[i].cells[2].firstChild.value}];
                  o[idx++] = toAdd;
                  }
		  }
                  popUp(JSON.stringify(o));
		  alert(n + " has been created.");
		  }

		  function popUp(n){

                  var newWindow = window.open("","Test","width=300,height=300,scrollbars=1,resizable=1")
                  var html = "<html><head></head><body>"+ n;
                  html += "</body></html>";
                  newWindow.document.open();
                  newWindow.document.write(html);
                  newWindow.document.close();
                  }
		  
                  function readSingleFile(e) {
var file = e.target.files[0];
  if (!file) {
    return;
  }
  var reader = new FileReader();
  reader.onload = function(e) {
    var contents = e.target.result;
    displayContents(contents);
  };
  reader.readAsText(file);
}

function displayContents(contents) {
var info = JSON.parse(contents);
var idx = 1;
for (var k in info) {
if (k == "title") continue;
		  var table = document.getElementById("myTable");
		  var row = table.insertRow(idx++);
		  var cell1 = row.insertCell(0);
		  var cell2 = row.insertCell(1);
		  var cell3 = row.insertCell(2);
		  var cell4 = row.insertCell(3);
		  cell1.innerHTML = "<input type='checkbox' checked/>";
		  cell2.innerHTML = "<input type='text' value='" + info[k][0].cond + "'/>";
		  cell3.innerHTML = "<input type='text' value='" + info[k][1].insn + "'/>";
		  cell4.innerHTML = "<input type='text' value='" + info[k][2].time + "'/>";
console.log(info[k][0].cond);
}
}

function addListeners() {
document.getElementById('file-input')
  .addEventListener('change', readSingleFile, false);
}
		</script>
	</head>
	
	<body onload="addListeners()">
	  <div id="header">
	    <br><div id="header-text">Surgery Concierge</div>
    	  </div>

	  <div id="template-form" style="text-align:center">
            <form id="the-form" name="myform" onsubmit="return onSubmitForm();">
	      <section>Create a New Surgery Template</section>
	      <br>
	      <input id='template-name' type='text' style="width:60%;font-size:20px" value='Title of Template'/>
	      <br><br>
	      <div style="float:left">Search Templates:</div><input type="file" id="file-input"/>
	      <br><br>
	      <table style="width:90%" id="myTable">
		<tr>
		  <th></th>
		  <th>Patient Condition</th>
		  <th>Instruction to Patient</th>
		  <th>When</th>
		</tr>
		<tr>
		  <td><input type='checkbox'/></td>
		  <td><input type='text' value='e.g. takes Aspirin regularly'/></td>
		  <td><input type='text' value='e.g. stop taking Aspirin'/></td>
		  <td><input type='text' value='e.g. seven days before the surgery'/></td>
		</tr>
	      </table>
	      <br>
	      <a style="float:left" onclick="createNewTemplate()">Add Item</a>
	      <br>
	      <br>
	      <input style="width:50%" type='submit' class="btn btn-default" value="Create Template"/>
	    </form>
	  </div>

	</body>
</html>
